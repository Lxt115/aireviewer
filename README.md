# 基于规则的大模型多模态智能审核平台

## 1. 项目概述

基于规则的大模型多模态智能审核平台是一个用于验证文档内容是否符合特定规则的智能工具。用户可以通过输入规则描述、上传相关文档，利用AI技术优化规则并执行校验，最终获得清晰的审核结果。

## 2. 技术栈

- **后端**: FastAPI + Python
- **前端**: React + TypeScript + Vite
- **UI组件库**: Ant Design

## 3. 快速启动

### 3.1 后端启动

1. 进入后端目录
   ```bash
   cd backend
   ```

2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```

3. 启动服务
   ```bash
   python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

4. 访问地址
   - API文档: http://localhost:8000/docs
   - 健康检查: http://localhost:8000/

### 3.2 前端启动

1. 进入前端目录
   ```bash
   cd frontend
   ```

2. 安装依赖
   ```bash
   npm install
   ```

3. 启动开发服务器
   ```bash
   npm run dev
   ```

4. 访问地址
   - 应用地址: http://localhost:5173 或 http://localhost:5174

## 4. 项目结构

```
AIReviewer/
├── backend/          # 后端代码
│   ├── app/          # 应用核心代码
│   │   ├── core/      # 核心功能
│   │   ├── db/        # 数据库相关
│   │   ├── models/    # 数据模型
│   │   ├── prompts/    # AI提示词模板
│   │   ├── routes/    # API路由
│   │   └── services/  # 业务逻辑
│   ├── uploads/      # 文件上传目录
│   └── main.py       # 后端入口
└── frontend/         # 前端代码
    ├── public/       # 静态资源
    └── src/          # 源代码
        ├── components/  # 组件
        ├── pages/       # 页面
        └── App.tsx       # 应用入口
```

## 5. 核心功能模块

### 5.1 业务场景管理

- 创建、查询、更新、删除业务场景
- 支持业务场景下的规则管理

### 5.2 规则管理

- 创建、查询、更新、删除规则
- 规则与业务场景关联
- 支持规则描述的AI优化

### 5.3 审核项管理

- 创建、查询、更新、删除审核项
- 审核项与规则关联

### 5.4 审核任务管理

- 创建、查询、更新、删除审核任务
- 支持批量文件审核
- 审核结果管理

### 5.5 规则校验模块

#### 5.5.1 功能概述

规则校验模块是平台的核心功能，用于验证文档内容是否符合特定规则。用户可以通过输入规则描述、上传相关文档，利用AI技术优化规则并执行校验，最终获得清晰的审核结果。

#### 5.5.2 用户目标

- 能够清晰地定义文档审核规则
- 利用AI能力优化规则描述，提高审核准确性
- 便捷地上传待审核文件和参考材料
- 获得准确、可解释的审核结果

#### 5.5.3 核心功能流程

1. **规则描述输入**
   - 提供多行文本输入框，支持至少500个字符
   - 输入框上方有明确的标题“执行逻辑”
   - 支持自动识别文档中的《》格式的文档名
   - 提供示例提示，引导用户输入有效的规则描述
   - **示例输入**：结合关联文档的《巡察整改台账》的【问题描述】信息，判断《整改方案》的整改任务中具体问题是否有缺漏

2. **文档上传**
   - 分两个区域：待审核文件、参考材料
   - 每个区域提供文件上传按钮，支持多选文件
   - 显示已上传文件列表，包含文件名、上传状态
   - 支持删除已上传的文件
   - 支持在下拉框中选择文件名后上传
   - 自动识别执行逻辑中带《》的文档，区分待审核文档和参考文档

3. **AI优化功能**
   - 提供【AI优化】按钮，通过大模型生成更清晰、更有效的规则提示词
   - 优化过程中显示加载状态
   - 优化结果直接显示在可编辑的文本框中
   - **优化效果示例**：
     > 原始输入：“结合关联文档的《巡察整改台账》的【问题描述】信息，判断《整改方案》的整改任务中具体问题是否有缺漏”
     > 
     > 优化后：
     > 1. 提取《整改方案》中“整改任务”章节的【问题*】描述；（文档中有多个问题）
     > 2. 提取《巡察整改台账》中的【二级问题】描述；（文档中有多个问题）
     > 3. 利用大模型能力，判断从两个文档中提取的问题描述，是否有缺漏或描述不一致的

4. **提示词编辑**
   - 提供多行文本编辑框，显示AI优化后的提示词
   - 编辑框支持格式化功能（如换行、缩进）
   - 支持实时编辑和调整

5. **规则校验执行**
   - 提供醒目的【开始校验】按钮，位于界面下方
   - 校验过程中显示加载动画和进度提示
   - 校验完成后显示结果统计信息（如通过率、总文件数）

6. **校验结果展示**
   - 以卡片形式展示每个文件的校验结果
   - 结果状态分为：通过、不通过
   - 提供展开/收起按钮，查看详细的审核理由列表
   - 理由列表采用清晰的条目式布局
   - **结果示例**：
     > 文件：《整改方案示例.docx》
     > 结果：不通过
     > 理由：
     > 1. 《整改方案》中未包含《巡察整改台账》中的第2条二级问题
     > 2. 《整改方案》中的第3条问题描述与《巡察整改台账》中的对应问题存在不一致

#### 5.5.4 界面布局设计

- **整体布局**：采用左右分栏布局
  - 左侧：业务场景与规则管理
  - 中间：规则设置（执行逻辑和优化工作区）
  - 右侧：校验结果

- **交互设计原则**：
  - 操作流程清晰，符合用户直觉
  - 关键按钮醒目，易于点击
  - 状态反馈及时，避免用户等待焦虑
  - 错误提示友好，提供明确的解决方案
  - 左侧面板可折叠，优化屏幕空间利用

- **视觉设计要求**：
  - 采用简洁、专业的设计风格
  - 主色调使用蓝色系，传达信任和专业感
  - 辅助色用于区分不同状态（通过-绿色，不通过-红色）
  - 字体清晰易读，层次分明
  - 间距合理，避免界面拥挤
  - 统一的白色底色，保持界面一致性
  - 减少不必要的嵌套和框线

#### 5.5.5 技术要求

- **AI能力集成**：
  - 与大语言模型API集成，实现规则优化功能
  - 支持上下文理解，能够结合参考文档内容进行校验
  - 自动识别文档类型和分类

- **文件处理能力**：
  - 支持常见文档格式（Word、PDF、Excel等）
  - 能够提取文档结构化内容
  - 支持大文件上传（最大100MB）
  - 支持自动识别文档中的《》格式的文档名

- **性能要求**：
  - 规则优化响应时间不超过5秒
  - 文档校验时间根据文件大小动态调整，最大不超过30秒
  - 支持同时处理最多10个文件

#### 5.5.6 核心AI服务功能

- **generate_audit_result**：生成审核结果
  - 参数：content, criteria, item_type
  - 功能：根据内容、规则和审核类型生成审核结果

- **validate_rule**：规则校验
  - 参数：rule, example_content, audit_items
  - 功能：验证规则对示例内容的审核效果

- **optimize_prompt**：提示词优化
  - 参数：original_prompt
  - 功能：优化规则描述为更清晰、更准确的AI提示词

#### 5.5.7 前端界面优化

- 移除多余的标题和嵌套框线
- 确保业务场景与规则面板可折叠且布局合理
- 保持各页面风格统一，包括全流程调试界面、审核任务流和版式库管理
- 优化按钮和输入框的大小和位置
- 确保界面布满整个屏幕，减少留白
- 修复界面崩溃和错误提示问题

#### 5.5.8 后端优化

- 将AI提示词存储在独立文件中，便于管理和优化
- 使用Pydantic模型优化API路由和数据验证
- 实现执行逻辑的保存功能
- 移除硬编码的API密钥，确保安全
- 优化AI服务函数，提高模块化和可维护性
- 实现文档自动识别和分类功能

## 6. AI服务

### 6.1 核心AI调用逻辑

- 封装了统一的AI调用接口，支持不同大模型提供商
- 支持提示词模板管理，便于维护和优化
- 支持敏感信息屏蔽，保障数据安全

### 6.2 主要AI功能

1. **generate_audit_result**
   - 生成审核结果
   - 参数：content, criteria, item_type
   - 返回：审核结果

2. **validate_rule**
   - 规则校验，验证规则对示例内容的审核效果
   - 参数：rule, example_content, audit_items
   - 返回：校验结果

3. **optimize_prompt**
   - 优化规则描述为更清晰、更准确的AI提示词
   - 参数：original_prompt
   - 返回：优化后的提示词

## 7. 技术架构

### 7.1 后端架构

- **FastAPI框架**：高性能API框架，支持异步操作
- **SQLite数据库**：轻量级数据库，便于部署
- **模块化设计**：清晰的代码结构，便于扩展

### 7.2 前端架构

- **React 18**：现代化前端框架
- **TypeScript**：类型安全
- **Ant Design**：企业级UI组件库
- **Vite**：快速的构建工具

## 8. 安全设计

- 输入验证：防止SQL注入、XSS攻击
- 敏感信息屏蔽：日志中的API Key等敏感信息自动屏蔽
- CORS配置：支持跨域请求

## 9. 验收标准

### 9.1 功能完整性

- 所有核心功能均可正常使用
- 流程无断点，用户可完成完整的规则校验

### 9.2 界面美观性

- 符合设计规范，界面简洁大方
- 交互流畅，无卡顿现象

### 9.3 结果准确性

- AI优化后的提示词确实提高了规则的清晰度和有效性
- 校验结果准确，理由充分合理

### 9.4 稳定性

- 系统运行稳定，无崩溃现象
- 异常情况处理得当，错误提示清晰

## 10. 未来规划

- 支持更多文档格式
- 增强AI优化能力
- 增加批量审核功能
- 支持规则版本管理
- 增强结果可视化
- 支持自定义AI模型配置
- 增加权限管理功能